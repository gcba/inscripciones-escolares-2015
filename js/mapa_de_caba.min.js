function ready(t,e,a){var o=[];$(document).mousemove(function(t){o[0]=t.clientX,o[1]=t.clientY});for(var r=0,n=Number.MAX_VALUE,s=1;16>s;s++)r<a.comunas[nivelActivo][s]&&(r=a.comunas[nivelActivo][s]),n>a.comunas[nivelActivo][s]&&(n=a.comunas[nivelActivo][s]);var c=d3.scale.linear().domain([n,r]).range(coloresCABA);svg.select(".caba").remove(),svg.select(".etiqueta").remove(),svg.append("g").attr("class","caba").selectAll("path").data(topojson.feature(e,e.objects.comunas).features).enter().append("path").attr("d",d3.geo.path().projection(d3.geo.mercator().scale(78500).center([-58.2,-34.68102]))).style("fill",function(t){return c(a.comunas[nivelActivo][t.properties.comuna])}).attr("title",function(t){return a.comunas[nivelActivo][t.properties.comuna]+"% nuevos alumnos"}).on("mouseover",function(t){$("#tooltipCABA").show(),d3.select(this).style("stroke","#ffffff");var e="<div style='font-size: 10px; text-transform: uppercase; color: #999999;'> comuna "+t.properties.comuna+" </div> "+a.comunas[nivelActivo][t.properties.comuna]+"% nuevos alumnos";$("#tooltipCABA").html(e)}).on("mouseout",function(){$("#tooltipCABA").hide(),d3.select(this).style("stroke","transparent")}).on("mousemove",function(){$("#tooltipCABA").show();d3.mouse(svg.node()).map(function(t){return parseInt(t)});d3.select("#tooltipCABA").attr("style",function(){return"left:"+(o[0]-60)+"px; top:"+(o[1]-70)+"px"})});var i=svg.append("svg:defs").append("svg:linearGradient").attr("id","gradient").attr("x1","0%").attr("x2","100%");i.append("svg:stop").attr("offset","20%").attr("stop-color",coloresCABA[0]).attr("stop-opacity",1),i.append("svg:stop").attr("offset","80%").attr("stop-color",coloresCABA[1]).attr("stop-opacity",1);var p=svg.append("g").attr("class","etiqueta").attr("transform","translate(170,267)");p.append("rect").attr("height",7).attr("x",0).attr("width","130").style("fill","url(#gradient)").style("stroke","white"),p.append("text").attr("class","tituloLeyenda").attr("y",-6).text("Alumnos por comuna"),p.append("text").attr("class","numeroLeyenda").attr("y",20).attr("x",0).text(function(){return redondeo(n,"DOWN")}),p.append("text").attr("class","numeroLeyenda").attr("y",20).attr("x",95).text(function(){return redondeo(r,"UP")})}function redondeo(t,e){switch(e){case"UP":var a="+ de "+(100*Math.round(t/100)-100).toString();break;case"DOWN":var a="- de "+(100*Math.round(t/100)).toString()}return a}$("#tooltipCABA").hide();var coloresCABA=["#eaeaea","#1977DD"],svg=d3.select("#mapaCABA").append("svg").attr("width",mapaSvg.ancho).attr("height",mapaSvg.alto).attr("x",mapaSvg.posInicialX).attr("y",mapaSvg.posInicialY);queue().defer(d3.json,"data/comunas.json").defer(d3.json,"data/data.json").await(ready);