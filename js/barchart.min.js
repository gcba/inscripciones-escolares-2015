$("#tooltipChart").hide();var mousePos=[];$(document).mousemove(function(a){mousePos[0]=a.clientX,mousePos[1]=a.clientY});var marginChart={top:100,right:70,bottom:40,left:170},widthChart=grillaSvg.ancho-marginChart.left-marginChart.right,heightChart=grillaSvg.alto-marginChart.top-marginChart.bottom,x=d3.scale.ordinal().rangeRoundBands([0,widthChart-110],.1),y=d3.scale.linear().rangeRound([heightChart,0]),color=d3.scale.ordinal().range(["#8DADFD","#F49167","#9E84D7"]),xAxis=d3.svg.axis().scale(x).orient("bottom"),yAxis=d3.svg.axis().scale(y).orient("left").ticks(2).tickFormat(d3.format(".1s")),svg=d3.select("#barChart").append("svg").attr("width",widthChart+marginChart.left+marginChart.right).attr("height",heightChart+marginChart.top+marginChart.bottom).append("g").attr("transform","translate("+marginChart.left+","+marginChart.top+")");d3.csv("data/datos-por-ano.csv",function(a,b){if(a)throw a;color.domain(d3.keys(b[0]).filter(function(a){return"Nivel"!==a})),b.forEach(function(a){var b=0;a.anos=color.domain().map(function(c){return{name:c,y0:b,y1:b+=+a[c],ano:a.Nivel}}),a.total=a.anos[a.anos.length-1].y1}),b.sort(function(a,b){return a.total-b.total}),x.domain(b.map(function(a){return a.Nivel})),y.domain([0,d3.max(b,function(a){return a.total})]),svg.append("g").attr("class","x axis").attr("transform","translate(0,"+heightChart+")").call(xAxis),svg.append("g").attr("class","y axis").call(yAxis);var c=svg.selectAll(".state").data(b).enter().append("g").attr("class","g").attr("transform",function(a){return"translate("+x(a.Nivel)+",0)"});c.selectAll("rect").data(function(a){return a.anos}).enter().append("rect").attr("width",x.rangeBand()).attr("y",function(a){return y(a.y1)}).attr("height",function(a){return y(a.y0)-y(a.y1)}).style("fill",function(a){return color(a.name)}).on("mouseover",function(a){$("#tooltipChart").show(),d3.select(this).style("stroke","#ffffff");var b="<div><b>"+(a.y1-a.y0)+"</b> inscriptos <br/>en <b>"+a.name.toLowerCase()+"</b></br>en <b>"+a.ano+"</b></div> ";$("#tooltipChart").html(b)}).on("mouseout",function(){$("#tooltipChart").hide(),d3.select(this).style("stroke","transparent")}).on("mousemove",function(){$("#tooltipChart").show();d3.mouse(svg.node()).map(function(a){return parseInt(a)});d3.select("#tooltipChart").attr("style",function(){return"left:"+(mousePos[0]-60)+"px; top:"+(mousePos[1]-80)+"px"})});var d=svg.selectAll(".legend").data(color.domain().slice().reverse()).enter().append("g").attr("class","legend").attr("transform",function(a,b){return"translate(0,"+20*b+")"});d.append("rect").attr("x",widthChart-18).attr("width",18).attr("height",18).style("fill",color),d.append("text").attr("x",widthChart-24).attr("y",9).attr("dy",".35em").style("text-anchor","end").text(function(a){return a})});