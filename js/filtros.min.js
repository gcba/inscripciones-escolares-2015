function calcularCategoria(a,b,c){for(var d,e=0,f=niveles[e].total,g=0;c>=f;)e++,f+=niveles[e].total;if(e>0){var h=e;for(g=0;h>0;)g+=niveles[h-1].total,h--}return d=c-g,d<b[e]?a[0]:a[1]}function filtrar(a){if("general"==currentSeccion){var b=json[currentSeccion][a],c=Object.keys(b),d=b[c[0]]*totalCirculos/100;d3.selectAll("circle").attr("class",function(a,b){return d>b?currentSeccion+" "+c[0]:currentSeccion+" "+c[1]}),d3.selectAll("circle").transition().attr("fill",function(a,b){return d>b?colores[c[0]]:colores[c[1]]})}else{for(var e=[],f=[],g=0;g<niveles.length;g++){var h=niveles[g][a];f=Object.keys(h),e.push(h[f[0]])}if(d3.selectAll("circle").attr("class",function(a,b){var c=d3.select(this).attr("nivel"),d=this.classList.contains("nivel_activo"),g=calcularCategoria(f,e,b),h=currentSeccion+" nivel"+c+" "+g;return d&&(h+=" nivel_activo"),h}),d3.selectAll("circle").transition().attr("fill",function(a,b){return colores[calcularCategoria(f,e,b)]}),"comuna"==currentSeccion){var i=$("circle.nivel_activo").attr("nivel");d3.selectAll("g.info text[nivel='"+i+"']").attr("class",function(){return d3.select(this).attr("class")+" nivel_activo animated fadeInUp"})}}}$("input[name=filtro]").click(function(){var a=$(this).attr("previousValue"),b=$(this).attr("name");if("checked"==a)$(this).removeAttr("checked"),$(this).attr("previousValue",!1),resetRadio(this),d3.selectAll("circle").attr("fill",colores.neutro).attr("class",function(){var a=currentSeccion+" general";if("general"!=currentSeccion){var b=d3.select(this).attr("nivel");if(a+=" nivel"+b,"comuna"==currentSeccion){var c=this.classList.contains("nivel_activo");c&&(a+=" nivel_activo")}}return a}),$("g.info").hide();else{$("input[name="+b+"]:radio").attr("previousValue",!1),$(this).attr("previousValue","checked");var c=$(this).val();filtrar(c),generarInfoText(c),$(this).blur()}});